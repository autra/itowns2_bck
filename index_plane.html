<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Lyon (plane mode)</title>

    <style type="text/css">
            html {height: 100%}
        body { margin: 0; overflow:hidden; height:100%}

            #viewerDiv {
                margin : auto auto;
                width: 100%;
                height: 100%;
                padding: 0;
                /*margin-top: 50vh;
                transform: translateY(-50%);*/
            }
            #menuDiv {position: absolute; top:0px; margin-left: 0px;}


        </style>
        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.1/dat.gui.min.js"></script>
    </head>
    <body>
        <div id="viewerDiv"></div>
        <script src="examples/GUI/GuiTools.js"></script>
        <script src="dist/itowns.js"></script>
        <script type="text/javascript">

            /* global itowns,document,GuiTools*/
            const viewerDiv = document.getElementById('viewerDiv');

            const bbox = new itowns.BoundingBox(
                1837816.94334, 1847692.32501,
                5170036.4587, 5178412.82698,
                0, 0,
                itowns.UNIT.METER);

            // create default scene
            var scene = new itowns.Scene(viewerDiv, false, false);
            scene.initDefaultProviders();

            // add plane geometry layer
            const epsg3946TileLayer = {
                protocol: 'tile',
                id: 'lyon',
                update: itowns.processing.tree.update,
                processNode: itowns.processing.tile.update,
                nodeType: itowns.TileMesh,
                maxLevel: 6,
                /* tile process */
                initLevel0Nodes: itowns.processing.tile.init(),
                schemeTile: itowns.processing.plane.schemeTile(bbox),
                cullingTest: itowns.processing.plane.culling,
                initNewNode: itowns.processing.layeredMaterial.init,
                mustSubdivide: itowns.processing.plane.subdivisionControl,
                builder: new itowns.builder.planar(),
            };

            scene.addLayer(epsg3946TileLayer);


            scene.addLayer({
                url       : "https://download.data.grandlyon.com/wms/grandlyon",
                protocol  : 'wms',
                version   : '1.3.0',
                id        : 'testwms',
                name      : 'Ortho2009_vue_ensemble_16cm_CC46',
                style      : "",
                projection : "EPSG:3946",
                transparent : false,
                bbox      : [bbox.minCoordinate.x(), bbox.maxCoordinate.x(), bbox.minCoordinate.y(), bbox.maxCoordinate.y()],
                unit: itowns.UNIT.METER, /* Meter */
                featureInfoMimeType : "",
                dateTime  : "",
                heightMapWidth : 256,
                waterMask      : false,
                updateStrategy: {
                    type: 0, /* see LayerUpdateStrategy.js */
                    options: {}
                },
                options: {
                    mimetype  : "image/jpeg"
                },
                update: itowns.processing.layeredMaterial.update_imagery,
            }, epsg3946TileLayer.id);

            scene.addLayer({
                url       : "https://download.data.grandlyon.com/wms/grandlyon",
                protocol  : 'wms',
                version   : '1.3.0',
                id        : 'testwmselev',
                name      : 'MNT2012_Altitude_10m_CC46',
                style      : "",
                projection : "EPSG:3946",
                transparent : false,
                bbox      : [bbox.minCoordinate.x(), bbox.maxCoordinate.x(), bbox.minCoordinate.y(), bbox.maxCoordinate.y()],
                unit: itowns.UNIT.METER,
                featureInfoMimeType : "",
                dateTime  : "",
                heightMapWidth : 256,
                waterMask      : false,
                options: {
                    minmaxElevation: [0, 255],
                    mimetype  : "image/jpeg"
                },
                update: itowns.processing.layeredMaterial.update_elevation,
            }, epsg3946TileLayer.id);

            scene.camera.camera3D.position.set(bbox.center.x, bbox.center.y, 10000);
            scene.camera.camera3D.lookAt(bbox.center.x, bbox.center.y, 0);
            scene.camera.camera3D.near = 0.1;
            scene.camera.camera3D.far = 10000;
            scene.camera.camera3D.updateProjectionMatrix();

            scene.notifyChange();

</script>
    </body>
</html>
